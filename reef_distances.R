
#
## calculate clark evans R
# Load the spatstat package
library(spatstat)
# Load the leaflet package
library(leaflet)

# Assuming df is your dataframe
#df <- data.frame(
 # reef = c("Reef 1", "Reef 2", "Reef 3"),
#  lon = c(-157.806396, -157.806473, -157.806783),
 # lat = c(21.464275, 21.464012, 21.46402)
#)

#just around AR1 - bigger R, more dispersed - 
#if they had bigger home ranges, smaller R
#importance of the scale of the system

df <- data.frame(
  reef = c("Reef 1.1", "Reef 1.2", "Reef 1.3","Reef 1.4","Reef 1.5","Reef 1.6","Reef 1.7","Reef 1.8","Reef 1.9","Reef 1.10",
           "Reef 1.11","Reef 1.12","Reef 1.13","Reef 1.14","Reef 1.15","Reef 1.16","Reef 1.17","Reef 1.18","Reef 1.19",
           "Reef 1.20"
  ),
  lon = c(-157.8067764909506, -157.8067780429044, -157.8067811468174,
          -157.8067858026792,-157.8067889065923, -157.8067904585464,
          -157.80679278648, -157.8067943384339, -157.8067951144136, 
          -157.8067943384343, -157.8067920105039, -157.8067889065939, 
          -157.8067858026813, -157.806781922797, -157.8067788188894,
          -157.8067764909532, -157.806774163022, -157.8067741630215,
          -157.8067741630209, -157.8067741630203
  ),
  
  lat = c(21.46402137212939, 21.4640220942915, 21.46402281645386, 21.46402281645457, 21.46402137213135, 21.46401920564711, 
          21.46401631700215, 21.46401415051787, 21.46401126187068, 21.46400765106253, 21.46400548457783, 21.46400404025581,
          21.46400331809253, 21.46400331809188, 21.46400404025412, 21.46400620673814, 21.46400909538295, 21.46401198402825,
          21.46401487267556, 21.46401848348366
  )
)

# Create an owin window based on the range of longitude and latitude
lon_range <- range(df$lon)
lat_range <- range(df$lat)
window <- owin(c(lon_range[1], lon_range[2]), c(lat_range[1], lat_range[2]))

# Convert to ppp object with the specified window
ppp_object <- ppp(df$lon, df$lat, marks = df$reef, window = window)

# Print the ppp object
print(ppp_object)
clarkevans(ppp_object)





#INCLUDING SURROUNDING NATURAL REEFS
df <- data.frame(
  reef = c(paste0("Reef 1.", 1:20), paste0("Reef 2.", 1:20), paste0("Reef 3.", 1:20), paste0("Reef 4.", 1:20),  paste0("Reef 5.", 1:20)
  ),
  lon = c(-157.8067764909506, -157.8067780429044, -157.8067811468174,
          -157.8067858026792,-157.8067889065923, -157.8067904585464,
          -157.80679278648, -157.8067943384339, -157.8067951144136, 
          -157.8067943384343, -157.8067920105039, -157.8067889065939, 
          -157.8067858026813, -157.806781922797, -157.8067788188894,
          -157.8067764909532, -157.806774163022, -157.8067741630215,
          -157.8067741630209, -157.8067741630203,
          
          #Reef 2
          -157.8064653238911, -157.8064676518256, -157.8064707557317, -157.8064738596436, -157.8064769635555, -157.806480067469,
          -157.8064823954071, -157.8064847233425, -157.8064854993283, -157.8064847233551, -157.8064831714062, -157.8064808434779,
          -157.8064777395711, -157.8064746356638, -157.8064715317538, -157.8064684278422, -157.8064653239245, -157.8064637719641,
          -157.8064622200036, -157.8064614440199,
          
          # Reef 3 longitudes
          -157.8063962610954, -157.806397037074, -157.8064001409917, -157.8064016929574, -157.8064024689444,
          -157.8064032449311, -157.8064047968965, -157.8064016929875, -157.8063985890743, -157.8063947091808,
          -157.8063916052652, -157.8063885013455, -157.8063861734032, -157.806384621437, -157.8063846214264,
          -157.8063853973997, -157.806388501308, -157.8063916052218, -157.8063947091377, -157.8063962610954, 
          
          # Natural Reef - Reef 4 longitudes
          -157.8072584744243, -157.8072336880931, -157.8072246749047, -157.807215661728, -157.8072066485308,
          -157.8071976353242, -157.8071908753999, -157.8071796089353, -157.8071705957626, -157.8071593292395,
          -157.8071480627277, -157.8071390495282, -157.8071255297407, -157.8071165165626, -157.8071165165906,
          -157.8071232765574, -157.8071322897661, -157.8071413029665, -157.8071525694482, -157.8071638359831,
          
          # Reef 5 longitudes
          -157.8066117784694, -157.8066095251731, -157.806605018581, -157.8066095251764, -157.8066185383676, -157.806629804859,
          -157.8066410713479, -157.80665008454, -157.8066636043283, -157.806672617515, -157.8066838840041, -157.8066928971971,
          -157.8067041636868, -157.8067154301846, -157.8067244433708, -157.8067334565727, -157.8067447230527, -157.8067582428487,
          -157.8067695093292, -157.8067762692353
  ),
  
  lat = c(21.46402137212939, 21.4640220942915, 21.46402281645386, 21.46402281645457, 21.46402137213135, 21.46401920564711, 
          21.46401631700215, 21.46401415051787, 21.46401126187068, 21.46400765106253, 21.46400548457783, 21.46400404025581,
          21.46400331809253, 21.46400331809188, 21.46400404025412, 21.46400620673814, 21.46400909538295, 21.46401198402825,
          21.46401487267556, 21.46401848348366,
          
          #Reef 2
          21.46401703881153, 21.46401776097707, 21.46401848314515, 21.46401776098953, 21.46401703883488, 21.46401559451735,
          21.46401342803746, 21.46401126155754, 21.46400837291381, 21.46400548426504, 21.46400331777759, 21.46400115128858,
          21.46399970695882, 21.46399970695263, 21.46399970694639, 21.46400042910292, 21.46400259558106, 21.46400548422318,
          21.4640083728673, 21.46401126151098,
          
          # Reef 3 latitudes
          21.46427701688581, 21.4642770168877, 21.46427629473626, 21.46427340608808, 21.46427051744616,
          21.46426762880026, 21.46426474015626, 21.46426257366407, 21.4642618514977, 21.46426185148828,
          21.46426185148069, 21.46426329579488, 21.46426546227389, 21.46426835091779, 21.46427196172854,
          21.46427412821535, 21.4642762947079, 21.46427701687447, 21.46427701688204, 21.46427701688581,
          
          # Natural reef - Reef 4 latitudes
          21.4644853274619, 21.46449161859543, 21.46449581265485, 21.46450210373487, 21.46450420078312,
          21.46450420080957, 21.4645062978503, 21.46450839489162, 21.46451468596784, 21.46451678301916,
          21.46452097709047, 21.46452097711364, 21.46452307415654, 21.46452726821971, 21.46453355926968,
          21.46454194731281, 21.46454404431207, 21.4645440442902, 21.46454614128346, 21.46454614125519,
          
          #Natural reef - Reef 5 latitudes
          21.46473906743688, 21.46473906743704, 21.46474745550036, 21.46475584358741, 21.46476213464103, 21.46476842569471,
          21.46477052270386, 21.46477052270251, 21.46477052270013, 21.46477261973244, 21.46477261972991, 21.46477261972766,
          21.4647726197246, 21.46477261972123, 21.46477261971834, 21.46477261971524, 21.46477052267683, 21.46477052267144,
          21.46476842565577, 21.46476842565271
  )
)

# Create an owin window based on the range of longitude and latitude

#windowdf
windowlats <- c(-157.8090770319891,-157.8050394745284, -157.8050639890607, -157.8090157997409)
windowlongs <-c(21.46645891213638, 21.46628811848027, 21.46280391389899, 21.46298608882223 )

lon_range <- range(df$lon) #range(windowlats) 
lat_range <- range(df$lat) #range(windowlongs) 
window <- owin(c(lon_range[1], lon_range[2]), c(lat_range[1], lat_range[2]))

# Convert to ppp object with the specified window
ppp_object <- ppp(df$lon, df$lat, marks = df$reef, window = window)

# Print the ppp object
print(ppp_object)

clarkevans(ppp_object)



# Create a leaflet map
map <- leaflet(df) %>%
  addTiles() %>%
  addCircleMarkers(
    lng = ~lon,
    lat = ~lat,
    radius = 5,
    color = "blue",
    fillOpacity = 0.8,
    popup = ~reef
  )

# Display the map
map





















